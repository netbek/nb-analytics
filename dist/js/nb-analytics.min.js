/*
 * nb-analytics
 * https://github.com/netbek/nb-analytics
 *
 * @author Hein Bekker <hein@netbek.co.za>
 * @copyright (c) 2015 Hein Bekker
 * @license http://www.gnu.org/licenses/agpl-3.0.txt AGPLv3
 */
!function(a,b,c){"use strict";function d(){var a={trackingId:c,create:c,prependPageViewUrl:!1,excludePageView:[]};return{set:function(b){_.merge(a,b)},$get:function(){return a}}}function e(c,d,e,f,g,h,i,j){var k,l={initialized:!1,ready:!1},m="";if(i.prependPageViewUrl===!0){var n=e.absUrl(),o=(e.protocol()+"://").length;o=n.indexOf("/",o),m=n.slice(o),o=m.indexOf("#"),o>-1&&(m=m.slice(0,o)),m=j.trimRight(m,"/")}else i.prependPageViewUrl!==!1&&(m=""+i.prependPageViewUrl);this.init=function(){if(!l.initialized)if(l.initialized=!0,k=f.defer(),i.trackingId){var c=h(function(){a.ga&&(h.cancel(c),a.ga("create",i.trackingId,b.isDefined(i.create)?i.create:"auto"),l.ready=!0,k.resolve(a.ga))},100),d="ga-js",e=document.getElementById(d);if(e);else{var g="//www.google-analytics.com/analytics.js";e=document.createElement("script"),e.id=d,e.async=!0,e.src=g;var j=document.getElementsByTagName("script")[0];j.parentNode.insertBefore(e,j)}}else l.ready=!1,k.reject("Tracking ID not given");return k.promise},this.trackPageView=function(b){var c=!1;j.forEach(i.excludePageView,function(a){if(j.isString(a)){if(a===b)return c=!0,!1}else if(j.isRegExp(a)&&a.test(b))return c=!0,!1}),c||this.init().then(function(){a.ga("set","page",m+b),a.ga("send","pageview",m+b)})},this.trackEvent=function(b,c,d,e){this.init().then(function(){a.ga("send","event",b,c,d,e)})},this.trackSocial=function(b,c,d,e){this.init().then(function(){a.ga("send","social",b,c,d,e)})}}b.module("nb.analytics",[]).provider("nbAnalyticsConfig",d).service("nbAnalytics",e),e.$inject=["$rootScope","$window","$location","$q","$timeout","$interval","nbAnalyticsConfig","_"]}(window,window.angular);